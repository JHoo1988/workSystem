<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>厂商管理</title>
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/shop.css">
</head>
<body>
<div id="shop">
    <el-container v-loading.fullscreen.lock="loading">
        <el-main>
            <div class="row1">
                <span class="title">厂商编码：</span>
                <template>
                    <el-input placeholder="请输厂商编码" v-model="shop_no" size="mini">
                    </el-input>
                </template>
                <span class="title">厂商名称：</span>
                <template>
                    <el-input placeholder="请输厂商名称" v-model="shop_name" size="mini">
                    </el-input>
                </template>
                <span class="title">联系人：</span>
                <template>
                    <el-input placeholder="请输联系人" v-model="contacts" size="mini">
                    </el-input>
                </template>
                <span class="title">厂商状态：</span>
                <template>
                    <el-select v-model="shopStatus" placeholder="请选择" size="mini">
                        <el-option
                                v-for="item in shopStatusOptions"
                                :key="item.value"
                                :label="item.label"
                                :value="item.value">
                        </el-option>
                    </el-select>
                </template>
                <span class="title">审核状态：</span>
                <template>
                    <el-select v-model="checkStatus" placeholder="请选择" size="mini">
                        <el-option
                                v-for="item in checkStatusOptions"
                                :key="item.value"
                                :label="item.label"
                                :value="item.value">
                        </el-option>
                    </el-select>
                </template>
            </div>
            <div class="row2">
                <el-button type="primary" size="mini" icon="el-icon-search" @click="search()">搜索</el-button>
                <el-button type="primary" plain size="mini" icon="el-icon-plus" @click="createShopDialogVisible = true">新建厂商</el-button>
                <!--<el-button type="primary" plain size="mini" v-if="putIn" @click="putInConsole()">放入操作台<i-->
                <!--class="el-icon-caret-right el-icon&#45;&#45;right"></i></el-button>-->
                <!--<el-badge :value="0" class="item">-->
                <!--<el-button type="primary" plain size="mini" icon="el-icon-edit-outline">操作台</el-button>-->
                <!--</el-badge>-->
            </div>
            <div class="row3">
                <template>
                    <el-table
                            ref="multipleTable"
                            :data="tableData"
                            border
                            stripe
                            style="width: 100%"
                            @selection-change="handleSelectionChange">
                        <el-table-column
                                type="selection"
                                width="35">
                        </el-table-column>
                        <el-table-column
                                fixed="left"
                                label="操作"
                                width="200">
                            <template slot-scope="scope">
                                <el-button @click="shopEditeClick(scope.row)" type="text" size="small" v-if="scope.row"
                                           v-text="scope.row.col16"></el-button>
                                <el-button @click="shopExamineClick(scope.row)" type="text" size="small"
                                           v-if="scope.row" v-text="scope.row.col17"></el-button>
                                <el-button @click="tableEdite(scope.row)" type="text" size="small" v-if="scope.row"
                                           v-text="scope.row.col18"></el-button>
                                <el-button @click="placeAnOrder(scope.row)" type="text" size="small" v-if="scope.row"
                                           v-text="scope.row.col19"></el-button>
                            </template>
                        </el-table-column>
                        <el-table-column
                                prop="col1"
                                label="厂商编码"
                                show-overflow-tooltip
                                width="110">
                        </el-table-column>
                        <el-table-column
                                prop="col2"
                                label="厂商ID"
                                show-overflow-tooltip
                                width="100">
                        </el-table-column>
                        <el-table-column
                                prop="col3"
                                label="厂商名称"
                                width="250">
                        </el-table-column>
                        <el-table-column
                                prop="col4"
                                label="厂商类别"
                                show-overflow-tooltip
                                width="80">
                        </el-table-column>
                        <el-table-column
                                prop="col5"
                                label="厂商性质"
                                show-overflow-tooltip
                                width="80">
                        </el-table-column>
                        <el-table-column
                                prop="col6"
                                label="联系人"
                                show-overflow-tooltip
                                width="80">
                        </el-table-column>
                        <el-table-column
                                prop="col7"
                                label="联系电话"
                                show-overflow-tooltip
                                width="120">
                        </el-table-column>
                        <el-table-column
                                prop="col8"
                                label="地址"
                                show-overflow-tooltip
                                width="250">
                        </el-table-column>
                        <el-table-column
                                prop="col9"
                                label="备注"
                                show-overflow-tooltip
                                width="250">
                        </el-table-column>
                        <el-table-column
                                label="合同"
                                width="50">
                            <template slot-scope="scope">
                                <el-button @click="downLoadContractClick(scope.row)" type="text" size="small">下载</el-button>
                            </template>
                        </el-table-column>
                        <el-table-column
                                prop="col10"
                                label="合同开始时间"
                                show-overflow-tooltip
                                width="180">
                        </el-table-column>
                        <el-table-column
                                prop="col11"
                                label="合同结束时间"
                                show-overflow-tooltip
                                width="180">
                        </el-table-column>
                        <el-table-column
                                prop="col12"
                                label="合同状态"
                                show-overflow-tooltip
                                width="80">
                        </el-table-column>
                        <el-table-column
                                prop="col13"
                                label="品牌"
                                show-overflow-tooltip
                                width="150">
                        </el-table-column>
                        <el-table-column
                                prop="col14"
                                label="厂商状态"
                                show-overflow-tooltip
                                width="80">
                        </el-table-column>
                        <el-table-column
                                prop="col15"
                                label="审核状态"
                                show-overflow-tooltip
                                width="80">
                        </el-table-column>
                    </el-table>
                </template>
            </div>
            <el-pagination
                    background
                    @current-change="handleCurrentChange"
                    :page-size="paginationPageSize"
                    layout="total, prev, pager, next, jumper"
                    :total="paginationTotal">
            </el-pagination>
        </el-main>
    </el-container>
    <el-dialog title="审核" :visible.sync="dialogFormVisible">
        <el-form :model="form" :rules="examineShopDialogRules" ref="form">
            <el-form-item label="厂商名称" :label-width="formLabelWidth">
                <span v-if="examineShopObject" v-text="examineShopObject.col3"></span>
            </el-form-item>
            <el-form-item label="审核操作" :label-width="formLabelWidth">
                <template>
                    <el-radio-group v-model="examineRadio">
                        <el-radio :label="0">通过</el-radio>
                        <el-radio :label="1">驳回</el-radio>
                    </el-radio-group>
                </template>
            </el-form-item>
            <el-form-item label="驳回原因" :label-width="formLabelWidth" v-if="examineRadio==1" prop="desc">
                <el-input v-model="form.desc" auto-complete="off" placeholder="请输入驳回原因"></el-input>
            </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button @click="dialogFormVisible = false">取 消</el-button>
            <el-button type="primary" @click="examine('form',examineShopObject.col2)">确 定</el-button>
        </div>
    </el-dialog>
    <el-dialog title="编辑" :visible.sync="editeShopDialogVisible" :close-on-click-modal="false">
        <el-form :model="editeShopForm" :rules="editeShopDialogRules" ref="editeShopForm">
            <el-form-item label="厂商编码" :label-width="formLabelWidth" prop="col1">
                <el-input v-model="editeShopForm.col1" auto-complete="off" placeholder="请输入厂商编码"></el-input>
            </el-form-item>
            <el-form-item label="厂商名称" :label-width="formLabelWidth" prop="col3">
                <el-input v-model="editeShopForm.col3" auto-complete="off" placeholder="请输入厂商名称"></el-input>
            </el-form-item>
            <el-form-item label="厂商类别" :label-width="formLabelWidth" prop="col4">
                <el-select v-model="editeShopForm.col4" placeholder="请选择厂商类别">
                    <el-option label="生产类" value="production"></el-option>
                    <el-option label="平台类" value="platform"></el-option>
                    <el-option label="经营商类" value="distributor"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="厂商性质" :label-width="formLabelWidth" prop="col5">
                <el-select v-model="editeShopForm.col5" placeholder="请选择厂商性质">
                    <el-option label="非TCL系" value="0"></el-option>
                    <el-option label="TCL系" value="1"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="联系人" :label-width="formLabelWidth" prop="col6">
                <el-input v-model="editeShopForm.col6" auto-complete="off" placeholder="请输入联系人"></el-input>
            </el-form-item>
            <el-form-item label="联系电话" :label-width="formLabelWidth" prop="col7">
                <el-input v-model="editeShopForm.col7" auto-complete="off" placeholder="请输入联系电话"></el-input>
            </el-form-item>
            <el-form-item label="住址" :label-width="formLabelWidth" prop="col8">
                <el-input v-model="editeShopForm.col8" auto-complete="off" placeholder="请输入住址"></el-input>
            </el-form-item>
            <el-form-item label="备注" :label-width="formLabelWidth" prop="col9">
                <el-input v-model="editeShopForm.col9" auto-complete="off" placeholder="请输入备注"></el-input>
            </el-form-item>
            <el-form-item label="合同上传" :label-width="formLabelWidth" prop="fileList">
                <el-upload
                        class="upload-demo"
                        action="https://jsonplaceholder.typicode.com/posts/"
                        :on-preview="handlePreview"
                        :on-remove="handleRemove"
                        :before-upload="beforeUpload"
                        :on-success="uploadSuccess"
                        :on-error="uploadError"
                        multiple
                        :limit="1"
                        :on-exceed="handleExceed"
                        accept="image/*"
                        list-type="picture"
                        :file-list="editeShopForm.fileList">
                    <el-button size="small" type="primary">点击上传</el-button>
                    <span slot="tip" class="el-upload__tip">只能上传jpg/png文件，且不超过2MB</span>
                </el-upload>
            </el-form-item>
            <el-form-item label="合同有效期" :label-width="formLabelWidth" prop="contractValidityValue">
                <el-date-picker
                        v-model="editeShopForm.contractValidityValue"
                        type="datetimerange"
                        range-separator="至"
                        end-placeholder="结束日期"
                        start-placeholder="开始日期"
                        align="">
                </el-date-picker>
            </el-form-item>
            <el-form-item label="合同状态" :label-width="formLabelWidth" prop="col12">
                <el-select v-model="editeShopForm.col12" placeholder="请选择合同状态">
                    <el-option label="未生效" value="0"></el-option>
                    <el-option label="已生效" value="1"></el-option>
                    <el-option label="已失效" value="2"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="厂商状态" :label-width="formLabelWidth" prop="col14">
                <el-select v-model="editeShopForm.col14" placeholder="请选择厂商状态">
                    <el-option label="停用" value="0"></el-option>
                    <el-option label="启用" value="1"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="品牌" :label-width="formLabelWidth" prop="col13">
                <template>
                    <el-checkbox-group v-model="editeShopForm.col13">
                        <el-checkbox v-for="brand in editeShopForm.col13Options" :label="brand" :key="brand" value="11100"></el-checkbox>
                    </el-checkbox-group>
                </template>
            </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button @click="editeShopDialogVisible = false">取 消</el-button>
            <el-button type="primary" @click="editeShop('editeShopForm')">更 新</el-button>
        </div>
    </el-dialog>
    <el-dialog title="新建厂商" :visible.sync="createShopDialogVisible" :close-on-click-modal="false">
        <el-form :model="createShopForm" :rules="editeShopDialogRules" ref="createShopForm">
            <el-form-item label="厂商编码" :label-width="formLabelWidth" prop="col1">
                <el-input v-model="createShopForm.col1" auto-complete="off" placeholder="请输入厂商编码"></el-input>
            </el-form-item>
            <el-form-item label="厂商名称" :label-width="formLabelWidth" prop="col3">
                <el-input v-model="createShopForm.col3" auto-complete="off" placeholder="请输入厂商名称"></el-input>
            </el-form-item>
            <el-form-item label="厂商类别" :label-width="formLabelWidth" prop="col4">
                <el-select v-model="createShopForm.col4" placeholder="请选择厂商类别">
                    <el-option label="生产类" value="production"></el-option>
                    <el-option label="平台类" value="platform"></el-option>
                    <el-option label="经营商类" value="distributor"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="厂商性质" :label-width="formLabelWidth" prop="col5">
                <el-select v-model="createShopForm.col5" placeholder="请选择厂商性质">
                    <el-option label="非TCL系" value="0"></el-option>
                    <el-option label="TCL系" value="1"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="联系人" :label-width="formLabelWidth" prop="col6">
                <el-input v-model="createShopForm.col6" auto-complete="off" placeholder="请输入联系人"></el-input>
            </el-form-item>
            <el-form-item label="联系电话" :label-width="formLabelWidth" prop="col7">
                <el-input v-model="createShopForm.col7" auto-complete="off" placeholder="请输入联系电话"></el-input>
            </el-form-item>
            <el-form-item label="住址" :label-width="formLabelWidth" prop="col8">
                <el-input v-model="createShopForm.col8" auto-complete="off" placeholder="请输入住址"></el-input>
            </el-form-item>
            <el-form-item label="备注" :label-width="formLabelWidth" prop="col9">
                <el-input v-model="createShopForm.col9" auto-complete="off" placeholder="请输入备注"></el-input>
            </el-form-item>
            <el-form-item label="合同上传" :label-width="formLabelWidth" prop="fileList">
                <el-upload
                        class="upload-demo"
                        action="https://jsonplaceholder.typicode.com/posts/"
                        :on-preview="handlePreview"
                        :on-remove="handleRemove"
                        :before-upload="beforeUpload"
                        :on-success="uploadSuccess"
                        :on-error="uploadError"
                        multiple
                        :limit="1"
                        :on-exceed="handleExceed"
                        accept="image/*"
                        list-type="picture"
                        :file-list="createShopForm.fileList">
                    <el-button size="small" type="primary">点击上传</el-button>
                    <span slot="tip" class="el-upload__tip">只能上传jpg/png文件，且不超过2MB</span>
                </el-upload>
            </el-form-item>
            <el-form-item label="合同有效期" :label-width="formLabelWidth" prop="contractValidityValue">
                <el-date-picker
                        v-model="createShopForm.contractValidityValue"
                        type="datetimerange"
                        range-separator="至"
                        end-placeholder="结束日期"
                        start-placeholder="开始日期"
                        align="">
                </el-date-picker>
            </el-form-item>
            <el-form-item label="合同状态" :label-width="formLabelWidth" prop="col12">
                <el-select v-model="createShopForm.col12" placeholder="请选择合同状态">
                    <el-option label="未生效" value="0"></el-option>
                    <el-option label="已生效" value="1"></el-option>
                    <el-option label="已失效" value="2"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="厂商状态" :label-width="formLabelWidth" prop="col14">
                <el-select v-model="createShopForm.col14" placeholder="请选择厂商状态">
                    <el-option label="停用" value="0"></el-option>
                    <el-option label="启用" value="1"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="品牌" :label-width="formLabelWidth" prop="col13">
                <template>
                    <el-checkbox-group v-model="createShopForm.col13">
                        <el-checkbox v-for="brand in createShopForm.col13Options" :label="brand" :key="brand" value="11100"></el-checkbox>
                    </el-checkbox-group>
                </template>
            </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button @click="createShopDialogVisible = false">取 消</el-button>
            <el-button type="primary" @click="createShop('createShopForm')">新 建</el-button>
        </div>
    </el-dialog>
</div>
</body>
<script src="../js/vue.js"></script>
<script src="../js/index.js"></script>
<script src="../js/axios.min.js"></script>
<script>
    new Vue({
        el: '#shop',
        data: function () {
            //自定义校验规则
            var validateHetong = (rule, value, callback) => {
                if (value.length <= 0) {
                    callback(new Error('请上传合同'));
                } else if (!value[0].name.endsWith('.jpg') || !value[0].name.endsWith('.jpeg') || !value[0].name.endsWith('.png')) {
                    callback(new Error('请上传图片类型'));
                } else {
                    callback();
                }
            };
            return {
                paginationTotal: 500,//总条数
                paginationPageSize: 20,//每一页显示的数量
                loading: false,// 加载框
                putIn: false,//“放入操作台”的按钮是否显示
                shop_no: '',// 厂商编码输入框的内容
                shop_name: '',// 厂商名称输入框的内容
                contacts: '',// 联系人输入框的内容
                shopStatusOptions: [{ //厂商状态选项
                    value: '0',
                    label: '停用'
                }, {
                    value: '1',
                    label: '启用'
                }],
                shopStatus: '',//用户选择的厂商状态
                checkStatusOptions: [{//审核状态选项
                    value: '0',
                    label: '未审核'
                }, {
                    value: '1',
                    label: '审核通过'
                }, {
                    value: '2',
                    label: '驳回'
                }],
                checkStatus: '',//用户选择的审核状态
                multipleSelection: [],//多选所选中的项
                tableData: [{
                    col1: 'SFDJJSONG',
                    col2: '10000032',
                    col3: '深圳十分到家服务科技有限公司',
                    col4: '经销商类',
                    col5: '非TCL系',
                    col6: '测试测',
                    col7: '027-12345678',
                    col8: '广东省深圳市南山区西丽街道中山园路1001号Tcl国际E城F5栋3楼',
                    col9: '备注：广东省深圳市南山区西丽街道中山园路1001号Tcl国际E城F5栋3楼',
                    col10: '2018-04-16 10:35:55',
                    col11: '2018-04-17 10:35:55',
                    col12: '已生效',
                    col13: '十分到家品牌',
                    col14: '启用',
                    col15: '已审核',
                    col16: '编辑',
                    col17: '审核',
                    col18: '表单配置',
                    col19: '下单',
                }],
                examineShopObject: null,// 选择的要审核的厂商对象
                editeShopObject: null,// 选择的要编辑的厂商对象
                dialogFormVisible: false,// “操作”-“审核”dialog是否显示
                form: {// 审核厂商 表单对象
                    desc: ''// 驳回原因
                },
                examineShopDialogRules: {
                    desc: [{
                        required: true, message: '请输入驳回原因', trigger: 'blur'
                    }]
                },
                formLabelWidth: '100px',
                examineRadio: 0, //0:表示选择通过，1：表示选择驳回
                editeShopDialogVisible: false, // “操作”-“编辑”dialog是否显示
                editeShopForm: {// 编辑厂商 表单对象
                    col1: '',// 厂商编码
                    col3: '',// 厂商名称
                    col4: '',// 厂商类别
                    col5: '',// 厂商性质
                    col6: '',// 联系人
                    col7: '',// 联系电话
                    col8: '',// 住址
                    col9: '',// 备注
                    // fileList: [{// 合同
                    //     name: 'food.jpeg',
                    //     url: 'https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100'
                    // }]
                    fileList: [],
                    contractValidityValue: '',//合同有效期
                    col12: '',//合同状态
                    col13:[],//已选品牌集合，根据服务端返回的结果填入即可
                    col13Options:['TCL','乐华','志高','雷鸟','美国西屋','商户平台-保内'],//品牌选项集合
                },
                editeShopDialogRules: {// 编辑/新建 厂商 表单校验规则
                    col1: [
                        {required: true, message: '请输入厂商编码', trigger: 'blur'}
                    ],
                    col3: [
                        {required: true, message: '请输入厂商名称', trigger: 'blur'}
                    ],
                    col4: [
                        {required: true, message: '请选择厂商类别', trigger: 'change'}
                    ],
                    col5: [
                        {required: true, message: '请选择厂商性质', trigger: 'change'}
                    ],
                    col6: [
                        {required: true, message: '请输入联系人', trigger: 'blur'}
                    ],
                    col7: [
                        {required: true, message: '请输入联系电话', trigger: 'blur'}
                    ],
                    fileList: [
                        {required: true, validator: validateHetong, trigger: 'blur'}
                    ],
                    contractValidityValue: [
                        {required: true, message: '请选择合同有效期', trigger: 'blur'}
                    ],
                    col12: [
                        {required: true, message: '请选择合同状态', trigger: 'change'}
                    ],
                    col14: [
                        {required: true, message: '请选择厂商状态', trigger: 'change'}
                    ],
                    col13: [
                        {required: true, message: '请选择品牌', trigger: 'blur'}
                    ]
                },
                createShopDialogVisible: false, // “新建厂商”dialog是否显示
                createShopForm: {// 编辑厂商 表单对象
                    col1: '',// 厂商编码
                    col3: '',// 厂商名称
                    col4: '',// 厂商类别
                    col5: '',// 厂商性质
                    col6: '',// 联系人
                    col7: '',// 联系电话
                    col8: '',// 住址
                    col9: '',// 备注
                    // fileList: [{// 合同
                    //     name: 'food.jpeg',
                    //     url: 'https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100'
                    // }]
                    fileList: [],
                    contractValidityValue: '',//合同有效期
                    col12: '',//合同状态
                    col13:[],//已选品牌集合，根据服务端返回的结果填入即可
                    col13Options:['TCL','乐华','志高','雷鸟','美国西屋','商户平台-保内'],//品牌选项集合
                }
            }
        },
        methods: {
            // 搜索按钮点击执行
            search: function () {
                // 请求参数
                var params = {
                    shop_no: this.shop_no,// 厂商编码输入框的内容
                    shop_name: this.shop_name,// 厂商名称输入框的内容
                    contacts: this.contacts,// 联系人输入框的内容
                    shopStatus: this.shopStatus,// 用户选择的厂商状态
                    checkStatus: this.checkStatus,// 联系人输入框的内容
                };
                this.request('/verify/code',params,'搜索失败',function (callback) {
                    // 搜索有结果-把搜索到的结果赋值给tableData3;
                    // $this.tableData=response.data.code;

                    // 如果没有搜索到结果，执行下面的一段提示
                    // $this.$alert('根据你设置的查询条件，没有搜索到相关厂商。', '提示', {
                    //     confirmButtonText: '确定',
                    //     type: 'warning',
                    //     center: true,
                    //     callback: action => {
                    //         //点击确定后的操作
                    //     }
                    // });
                });
            },
            // 分页点击执行
            handleCurrentChange(val) {
                // 页数改变，需要改变查询
                // console.log(`当前页: ${val}`);
                this.tableData = [];//先清空表格数据
                // 请求参数
                var params = {
                    pageSize: val// 改变页码
                };
                this.request('/verify/code',params,'查询失败',function (callback) {
                });
            },
            // 多选事件
            handleSelectionChange(val) {
                this.multipleSelection = val;
                if (this.multipleSelection.length > 0) {
                    this.putIn = true;
                } else {
                    this.putIn = false;
                }
            },
            // 放入操作台 事件
            putInConsole(rows) {
                // 1.执行放入操作台的操作

                // 2.清空勾选
                if (rows) {
                    rows.forEach(row => {
                        this.$refs.multipleTable.toggleRowSelection(row);
                    });
                } else {
                    this.$refs.multipleTable.clearSelection();
                }
            },
            // 操作-审核按钮 点击事件
            shopExamineClick(row) {
                this.examineShopObject = row;
                this.examineRadio = 0;
                this.form.desc = '';
                this.dialogFormVisible = true;
            },
            // 操作-表单配置按钮 点击事件
            tableEdite(row) {
                this.examineShopObject = row;
                this.$message('该功能正在开发中...');
            },
            // 操作-下单按钮 点击事件
            placeAnOrder(row) {
                this.examineShopObject = row;
                this.$message('该功能正在开发中...');
            },
            // 操作-审核-确定 按钮点击事件
            examine(formName, id) {
                var $this = this;
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        var url = null;
                        var param = null;
                        if ($this.examineRadio == 0) {
                            // 审核通过
                            url = '/verify/code';
                            param = {
                                id: id
                            }
                        } else {
                            // 驳回
                            url = '/verify/code';
                            param = {
                                id: id,
                                desc: $this.form.desc
                            }
                        }
                        this.request(url,param,'审核失败',function (callback) {
                            // 审核操作成功;
                            $this.dialogFormVisible = false
                        });
                    } else {
                        return false;
                    }
                });
            },
            // 操作-编辑按钮 点击事件
            shopEditeClick(row) {
                this.editeShopObject = row;
                this.editeShopDialogVisible = true;
                if (this.$refs['editeShopForm']) {
                    this.$refs['editeShopForm'].resetFields();
                }
            },
            // 操作-编辑-更新 按钮点击事件
            editeShop(formName) {
                console.log("选择的日期是=" + this.editeShopForm.contractValidityValue);
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        var params={
                            // 编辑厂商要传的参数
                        };
                        this.request('',params,'编辑失败',function (callback) {
                            // 重置表单
                            if (this.$refs['editeShopForm']) {
                                this.$refs['editeShopForm'].resetFields();
                            }
                            // 关闭dialog
                            this.editeShopDialogVisible = false;
                        });
                    } else {
                        return false;
                    }
                });
            },
            uploadSuccess(response, file, fileList) {
                // 合同上传成功
                console.log(response);
                console.log(fileList);
            },
            uploadError(err, file, fileList) {
                //合同上传失败
                this.$message.warning(`合同上传失败，请重试`);
            },
            handleRemove(file, fileList) {
                console.log(file, fileList);
            },
            handlePreview(file) {
                console.log(file);
            },
            handleExceed(files, fileList) {
                this.$message.warning(`当前限制上传1个文件`);
            },
            beforeUpload(file) {// 合同上传之前的判断：判断大小和类型
                if (file.type != "image/jpeg" && file.type != "image/png") {
                    this.$message.warning(`请上传jpg或png图片文件`);
                    return false;
                } else if ((file.size / 1024) >= 2048) {
                    this.$message.warning(`请上传2MB以内的图片文件`);
                    return false;
                }
            },
            // 合同-下载 点击事件
            downLoadContractClick(row) {
                this.editeShopObject = row;
            },
            // 新建厂商dialog中 新建 按钮点击事件
            createShop(formName) {
                console.log("选择的日期是=" + this.createShopForm.contractValidityValue);
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        var params={
                            // 编辑厂商要传的参数
                        };
                        this.request('',params,'新建厂商失败',function (callback) {
                            // 重置表单
                            if (this.$refs['createShopForm']) {
                                this.$refs['createShopForm'].resetFields();
                            }
                            // 关闭dialog
                            this.createShopDialogVisible = false;
                        });
                    } else {
                        return false;
                    }
                });
            },
            getAxiosInstance: function () {
                var _self = this;
                var instance = axios.create({
                    baseURL: "http://120.76.157.13:666/mapi",
                    method: 'post'
                });
                instance.interceptors.request.use(function (config) {
                    // 在发送请求之前做些什么
                    _self.loading = true;
                    return config;
                }, function (error) {
                    // 对请求错误做些什么
                    _self.loading = false;
                    _self.$message.error('加载失败');
                    return Promise.reject(error);
                });
                instance.interceptors.response.use(function (response) {
                    //对响应数据做点什么
                    // 关闭加载框
                    _self.loading = false;
                    return response;
                }, function (error) {
                    // 对响应错误做点什么 error.response.status
                    // 关闭加载框
                    _self.loading = false;
                    return Promise.reject(error);
                });
                return instance;
            },
            // 请求封装
            request(url,params,errorToast,callback){
                var $this = this;
                $this.getAxiosInstance().post(url, params).then(function (response) {
                    if (response.status == 200) {
                        if (response.data.code == '0000') {
                            callback(response.data.data);//请求结果回调
                        } else {
                            // 其他返回结果
                            $this.$message.warning(response.data.msg);
                        }
                    } else {
                        $this.$message.error(errorToast);
                    }
                }).catch(function (error) {
                    if (error.response && error.response.status != 200) {
                        // 请求已发出，但服务器响应的状态码不在 2xx 范围内
                        $this.$message.error(errorToast);
                    } else {
                        $this.$message.error('网络异常');
                    }
                });
            }
        }
    })
</script>
</html>
<script>
    import CreatShop from "./components/creatShop";
    export default {
        components: {CreatShop}
    }
</script>